<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Signup ‚Äî ‡¶ï‡ßÅ‡¶Å‡¶°‡¶º‡ßá‡¶ò‡¶∞ ‡¶´‡ßç‡¶Ø‡¶æ‡¶∂‡¶® ‡¶π‡¶æ‡¶â‡¶∏</title>

<!-- ‚úÖ Google Sign-In -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<!-- ‚úÖ EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>
body{
  font-family:Inter,Arial;display:flex;align-items:center;justify-content:center;
  min-height:100vh;background:#fff;color:#111;margin:0;
}
.box{width:92%;max-width:420px;background:#fff8f3;padding:22px;
border:1px solid #f0e6de;border-radius:12px;}
input,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;
border:1px solid #ddd;}
button{background:#ff6a00;color:#fff;border:none;cursor:pointer;}
.otp-box{display:none;margin-top:10px;}
.divider{text-align:center;margin:15px 0;color:#666;}
</style>
</head>
<body>

<div class="box">
  <h2>Signup</h2>

  <!-- üåê Google Sign-In -->
  <div id="g_id_onload"
       data-client_id="751325738501-un055mf6o8jlo8p0va24hjht2jqijfk4.apps.googleusercontent.com"
       data-context="signup"
       data-ux_mode="popup"
       data-callback="handleGoogleResponse">
  </div>
  <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"></div>

  <div class="divider">‚Äî or Signup with Email ‚Äî</div>

  <label>Email</label>
  <input id="email" type="email" placeholder="example@gmail.com" />
  <label>Full Name</label>
  <input id="name" placeholder="Your Name" />
  <label>Phone</label>
  <input id="phone" placeholder="01XXXXXXXXX" />
  <label>Password</label>
  <input id="password" type="password" placeholder="Create password" />
  <button id="send-otp">Send OTP</button>

  <div class="otp-box" id="otp-box">
    <label>Enter OTP</label>
    <input id="otp-input" placeholder="6-digit OTP" />
    <button id="verify-otp">Verify & Create Account</button>
  </div>
</div>

<script>
/* ---------- EmailJS OTP Setup ---------- */
emailjs.init("Flmwubg3ooVoycoAS"); // ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ EmailJS Public Key ‡¶¨‡¶∏‡¶æ‡¶ì

let sentOTP = null;

document.getElementById('send-otp').addEventListener('click', ()=> {
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim().toLowerCase();
  const phone = document.getElementById('phone').value.trim();
  const password = document.getElementById('password').value.trim();

  if(!email || !password){ alert('Email ‡¶ì Password ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞'); return; }

  const users = JSON.parse(localStorage.getItem('rebel_users')||'[]');
  if(users.find(u=>u.email===email)){ alert('Email already registered'); return; }

  sentOTP = Math.floor(100000 + Math.random()*900000);
  const time = new Date().toLocaleString();

  emailjs.send("service_qymsx6v","template_u1gxmq4",{
    to_name: name || "User",
    to_email: email,
    otp: sentOTP,
    time: time
  })
  .then(()=>{
    alert('‚úÖ OTP ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Gmail ‡¶è: '+email);
    document.getElementById('otp-box').style.display='block';
  })
  .catch(e=>{
    console.error(e);
    alert('‚ùå OTP ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡ßü‡ßá‡¶õ‡ßá! Console ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßã‡•§');
  });
});

document.getElementById('verify-otp').addEventListener('click', ()=>{
  const otp = document.getElementById('otp-input').value.trim();
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim().toLowerCase();
  const phone = document.getElementById('phone').value.trim();
  const password = document.getElementById('password').value.trim();

  if(otp != sentOTP){ alert('‚ùå ‡¶≠‡ßÅ‡¶≤ OTP'); return; }

  const users = JSON.parse(localStorage.getItem('rebel_users')||'[]');
  const newUser = {name,email,phone,password};
  users.push(newUser);
  localStorage.setItem('rebel_users', JSON.stringify(users));
  localStorage.setItem('rebel_user', JSON.stringify(newUser));

  alert('üéâ Signup Successful! Welcome '+(name||email));
  window.location.href = 'index.html';
});

/* ---------- Google Signup ---------- */
function handleGoogleResponse(response){
  try{
    const data = JSON.parse(atob(response.credential.split('.')[1]));
    const user = {
      name: data.name || '',
      email: data.email || '',
      phone: '',
      password: ''
    };
    const users = JSON.parse(localStorage.getItem('rebel_users') || '[]');
    if(!users.find(u=>u.email===user.email)){
      users.push(user);
      localStorage.setItem('rebel_users', JSON.stringify(users));
    }
    localStorage.setItem('rebel_user', JSON.stringify(user));
    alert("üëã Welcome "+(user.name||user.email));
    window.location.href='index.html';
  }catch(e){
    console.error(e);
    alert('‚ùå Google Signup Failed');
  }
}
</script>

</body>
</html>
